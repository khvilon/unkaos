FROM node:23-alpine

WORKDIR /app

# Копируем общие утилиты
COPY ./server/tools.ts ./server/
COPY ./server/tools.d.ts ./server/
COPY ./server/string.extensions.ts ./server/

# Копируем сначала только файлы для установки зависимостей
COPY ./server/cerberus/package.json ./cerberus/
WORKDIR /app/cerberus
RUN yarn install

# Затем копируем файлы сервиса
COPY ./server/cerberus .

USER node

CMD [ "npx", "ts-node", "index.ts" ]