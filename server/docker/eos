FROM node:16.19.0-bullseye-slim

COPY ./server /app
WORKDIR /app/eos
RUN yarn install
RUN npm i js-yaml
RUN npm i --save-dev @types/js-yaml
RUN yarn build

RUN apt-get update && \
    apt-get install -y docker.io
# Install Docker Compose CLI
RUN apt-get install -y curl && \
    curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose && \
    chmod +x /usr/local/bin/docker-compose

USER node

CMD [ "npx", "ts-node", "index.ts" ]
